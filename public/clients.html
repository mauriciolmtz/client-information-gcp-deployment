<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Information Database</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        .container {
            max-width: 1200px;
        }
        .table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        .action-buttons button {
            padding: 5px 10px;
            font-size: 12px;
        }
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            background-color: #d4edda;
            color: #155724;
        }
        .pagination-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .pagination-container select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>í³‹ Client Information Database</h1>
            <p class="mb-0">Manage and view all client information</p>
        </div>
    </div>

    <div class="container">
        <div class="mb-4">
            <button class="btn btn-primary" onclick="showAddForm()">+ Add New Client</button>
            <span class="status-badge" style="float:right;">Status: <span id="status">Loading...</span></span>
        </div>

        <div class="table-container">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Company</th>
                        <th>City</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="clientsTable">
                    <tr><td colspan="8" class="text-center">Loading clients...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="pagination-container">
            <label>Records per page:</label>
            <select id="pageSize" onchange="changePageSize()">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
            </select>
            <div id="paginationButtons"></div>
        </div>
    </div>

    <script>
        let currentPage = 1;
        let pageSize = 10;

        async function loadClients() {
            try {
                document.getElementById('status').textContent = 'Connected';
                document.getElementById('status').parentElement.style.backgroundColor = '#d4edda';
                
                const response = await fetch(`/api/clients?page=${currentPage}&limit=${pageSize}`);
                const data = await response.json();

                const tbody = document.getElementById('clientsTable');
                tbody.innerHTML = '';

                if (data.clients && data.clients.length > 0) {
                    data.clients.forEach(client => {
                        const row = `
                            <tr>
                                <td>${client.id}</td>
                                <td>${client.first_name}</td>
                                <td>${client.last_name}</td>
                                <td>${client.email}</td>
                                <td>${client.phone || 'N/A'}</td>
                                <td>${client.company || 'N/A'}</td>
                                <td>${client.city || 'N/A'}</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-info" onclick="viewClient(${client.id})">View</button>
                                        <button class="btn btn-sm btn-warning" onclick="editClient(${client.id})">Edit</button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteClient(${client.id})">Delete</button>
                                    </div>
                                </td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center">No clients found</td></tr>';
                }

                renderPagination(data.totalPages || 1);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('status').textContent = 'Error';
                document.getElementById('status').parentElement.style.backgroundColor = '#f8d7da';
            }
        }

        function renderPagination(totalPages) {
            const buttons = document.getElementById('paginationButtons');
            buttons.innerHTML = '';

            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = `btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-outline-primary'}`;
                btn.textContent = i;
                btn.onclick = () => { currentPage = i; loadClients(); };
                buttons.appendChild(btn);
            }
        }

        function changePageSize() {
            pageSize = document.getElementById('pageSize').value;
            currentPage = 1;
            loadClients();
        }

        function deleteClient(id) {
            if (confirm('Are you sure you want to delete this client?')) {
                fetch(`/api/clients/${id}`, { method: 'DELETE' })
                    .then(() => { alert('Client deleted'); loadClients(); })
                    .catch(error => alert('Error: ' + error));
            }
        }

        function viewClient(id) {
            alert('View client ' + id);
        }

        function editClient(id) {
            alert('Edit client ' + id);
        }

        function showAddForm() {
            alert('Add new client form');
        }

        // Load clients on page load
        window.addEventListener('DOMContentLoaded', loadClients);

        // Refresh every 30 seconds
        setInterval(loadClients, 30000);
    </script>
</body>
</html>
